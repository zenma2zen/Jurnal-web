<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>WHARSA - Academic Reference Search</title>
  <script src="https://accounts.google.com/gsi/client" async defer></script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
</head>
<body>
  <header>
    <h1>WHARSA</h1>
    <div id="authSection">
      <button id="signInBtn">Login dengan Google</button>
      <button id="signOutBtn" style="display:none;">Logout</button>
      <span id="userInfo"></span>
    </div>
  </header>

  <main>
    <h2>Hasil Pencarian Jurnal</h2>

    <!-- Contoh hasil jurnal -->
    <div class="result-card">
      <h3>Contoh Jurnal 1</h3>
      <p>Ini contoh abstrak jurnal.</p>
      <button onclick="saveBookmark('Contoh Jurnal 1', 'https://contoh-jurnal.com', ['fisika','sains'])">üîñ Tambahkan Bookmark</button>
    </div>

    <div class="result-card">
      <h3>Contoh Jurnal 2</h3>
      <p>Ini contoh abstrak jurnal kedua.</p>
      <button onclick="saveBookmark('Contoh Jurnal 2', 'https://contoh-jurnal-2.com', ['teknologi'])">üîñ Tambahkan Bookmark</button>
    </div>
  </main>

  <footer>
    <a href="bookmark.html">üìö Lihat Bookmark Saya</a>
  </footer>

  <!-- Firebase -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
    import { 
      getAuth, GoogleAuthProvider, signInWithPopup, signOut, onAuthStateChanged 
    } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";
    import { 
      getFirestore, collection, addDoc, serverTimestamp 
    } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

    // üî• Ganti dengan konfigurasi Firebase-mu
    const firebaseConfig = {
      apiKey: "API_KEY",
      authDomain: "PROJECT_ID.firebaseapp.com",
      projectId: "PROJECT_ID",
      storageBucket: "PROJECT_ID.appspot.com",
      messagingSenderId: "SENDER_ID",
      appId: "APP_ID"
    };

    // Init Firebase
    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);
    const provider = new GoogleAuthProvider();

    const signInBtn = document.getElementById("signInBtn");
    const signOutBtn = document.getElementById("signOutBtn");
    const userInfo = document.getElementById("userInfo");
    let currentUser = null;

    // Login
    signInBtn.addEventListener("click", async () => {
      try {
        await signInWithPopup(auth, provider);
      } catch (error) {
        console.error("Login error:", error);
      }
    });

    // Logout
    signOutBtn.addEventListener("click", async () => {
      await signOut(auth);
    });

    // Monitor status login
    onAuthStateChanged(auth, (user) => {
      if (user) {
        currentUser = user;
        userInfo.textContent = `Login sebagai ${user.displayName}`;
        signInBtn.style.display = "none";
        signOutBtn.style.display = "inline-block";
      } else {
        currentUser = null;
        userInfo.textContent = "";
        signInBtn.style.display = "inline-block";
        signOutBtn.style.display = "none";
      }
    });

    // ‚úÖ Fungsi simpan bookmark (100% cocok dengan bookmark.html)
    window.saveBookmark = async function(title, url, tags = []) {
      if (!currentUser) {
        alert("‚ö†Ô∏è Silakan login dulu untuk menyimpan bookmark.");
        return;
      }
      try {
        await addDoc(collection(db, "bookmarks"), {
          title: title,
          url: url,
          tags: tags,
          userId: currentUser.uid,   // harus ada biar bisa difilter di bookmark.html
          createdAt: serverTimestamp(),
          updatedAt: serverTimestamp()
        });
        alert("‚úÖ Bookmark berhasil disimpan!");
        console.log("Bookmark tersimpan untuk:", currentUser.uid);
      } catch (e) {
        console.error("Error menambahkan bookmark: ", e);
      }
    }
  </script>
</body>
</html>
