<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Wahasa Search - Platform Pencarian Jurnal Ilmiah</title>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <script>
    const API_KEY = "AIzaSyDM4a0GLSA3lMRYJSTzgoUfG88OZI-1MJI";
    const CX = "332c680f2381f4787";
    const NEWS_URL = "https://berita-indo-api.vercel.app/v1/cnn-news/internasional";

    let currentPage = 1;
    let lastQuery = "";
    let totalResults = 0;
    let selectedYear = "";
    let showCitationTools = false;

    async function fetchLatestNews() {
      try {
        let response = await fetch(NEWS_URL);
        let data = await response.json();
        let newsContainer = document.getElementById("newsContainer");
        newsContainer.innerHTML = `
          <div class="section-header">
            <h3>üåç Berita Internasional Terkini</h3>
          </div>
          <div class="news-grid" id="newsGrid"></div>
        `;

        let newsGrid = document.getElementById("newsGrid");
        
        if (data.data && data.data.length > 0) {
          data.data.slice(0, 6).forEach(article => {
            let newsItem = document.createElement("div");
            newsItem.classList.add("news-card");
            newsItem.innerHTML = `
              <div class="news-content">
                <h4><a href="${article.link}" target="_blank">${article.title}</a></h4>
                <p class="news-snippet">${article.contentSnippet || "Deskripsi tidak tersedia"}</p>
                <p class="news-date">${article.isoDate ? new Date(article.isoDate).toLocaleDateString('id-ID') : ''}</p>
              </div>
              ${article.image ? `<img src="${article.image.small}" alt="${article.title}" class="news-image">` : ''}
            `;
            newsGrid.appendChild(newsItem);
          });
        } else {
          newsContainer.innerHTML += "<p class='no-data'>Tidak ada berita terbaru yang ditemukan.</p>";
        }
      } catch (error) {
        console.error("Error fetching news:", error);
        document.getElementById("newsContainer").innerHTML += "<p class='error-msg'>Gagal memuat berita. Silakan coba lagi.</p>";
      }
    }

    function searchJournals(query, page = 1) {
      if (!query.trim()) {
        document.getElementById("searchResults").innerHTML = "<p class='no-data'>Masukkan kata kunci pencarian</p>";
        return;
      }
      
      lastQuery = query;
      currentPage = page;
      const startIndex = (page - 1) * 10 + 1;
      
      // Tambahkan filter tahun jika dipilih
      let searchQuery = query;
      if (selectedYear) {
        searchQuery += ` after:${selectedYear}-01-01 before:${selectedYear}-12-31`;
      }
      
      const url = `https://www.googleapis.com/customsearch/v1?q=${encodeURIComponent(searchQuery)}&cx=${CX}&key=${API_KEY}&start=${startIndex}`;

      document.getElementById("searchResults").innerHTML = `
        <div class="loading-spinner">
          <div class="spinner"></div>
          <p>Mencari jurnal...</p>
        </div>
      `;

      fetch(url)
        .then(response => response.json())
        .then(data => {
          totalResults = data.searchInformation?.totalResults || 0;
          displayResults(data);
        })
        .catch(error => {
          console.error("Error fetching search results:", error);
          document.getElementById("searchResults").innerHTML = `
            <p class='error-msg'>Gagal memuat hasil pencarian. Silakan coba lagi.</p>
          `;
        });
    }

    function displayResults(data) {
      let resultsContainer = document.getElementById("searchResults");
      resultsContainer.innerHTML = "";

      if (data.items && data.items.length > 0) {
        let yearFilterInfo = selectedYear ? `<span class="year-filter-info">(Filter tahun: ${selectedYear})</span>` : "";
        
        resultsContainer.innerHTML = `
          <div class="results-header">
            <div>
              <h3>Hasil Pencarian untuk "${lastQuery}"</h3>
              ${yearFilterInfo}
            </div>
            <p class="results-count">${totalResults} hasil ditemukan</p>
          </div>
          <div class="results-grid" id="resultsGrid"></div>
        `;

        let resultsGrid = document.getElementById("resultsGrid");
        
        data.items.forEach(item => {
          let resultItem = document.createElement("div");
          resultItem.classList.add("result-card");
          resultItem.innerHTML = `
            <div class="result-content">
              <h3><a href="${item.link}" target="_blank">${item.title}</a></h3>
              <p class="result-url">${new URL(item.link).hostname.replace('www.', '')}</p>
              <p class="result-snippet">${item.snippet}</p>
              <div class="result-meta">
                ${extractYearFromResult(item.snippet) ? `<span class="result-year">${extractYearFromResult(item.snippet)}</span>` : ''}
              </div>
            </div>
          `;
          resultsGrid.appendChild(resultItem);
        });

        displayPagination();
      } else {
        let noResultsMessage = selectedYear 
          ? `<p>Tidak ada hasil ditemukan untuk "${lastQuery}" pada tahun ${selectedYear}</p>`
          : `<p>Tidak ada hasil ditemukan untuk "${lastQuery}"</p>`;
        
        resultsContainer.innerHTML = `
          <div class="no-results">
            <img src="https://cdn-icons-png.flaticon.com/512/4076/4076478.png" alt="No results" width="100">
            <h3>Tidak ada hasil ditemukan</h3>
            ${noResultsMessage}
            <p>Coba gunakan kata kunci yang berbeda atau hapus filter tahun</p>
          </div>
        `;
      }
    }

    // Fungsi untuk mengekstrak tahun dari snippet hasil pencarian
    function extractYearFromResult(snippet) {
      const yearMatch = snippet.match(/(19|20)\d{2}/);
      return yearMatch ? yearMatch[0] : null;
    }

    function performSearch() {
      let query = document.getElementById("searchInput").value.trim();
      if (query) {
        currentPage = 1;
        searchJournals(query, currentPage);
      }
    }

    function displayPagination() {
      const totalPages = Math.min(Math.ceil(totalResults / 10), 10); // Batasi maksimal 10 halaman
      if (totalPages <= 1) return;

      const paginationContainer = document.createElement("div");
      paginationContainer.classList.add("pagination");

      // Tombol Previous
      if (currentPage > 1) {
        let prevLink = document.createElement("a");
        prevLink.href = "#";
        prevLink.innerHTML = "&laquo;";
        prevLink.onclick = function() {
          searchJournals(lastQuery, currentPage - 1);
          return false;
        };
        paginationContainer.appendChild(prevLink);
      }

      // Tampilkan beberapa nomor halaman sekitar halaman saat ini
      const startPage = Math.max(1, currentPage - 2);
      const endPage = Math.min(totalPages, currentPage + 2);

      for (let i = startPage; i <= endPage; i++) {
        let pageLink = document.createElement("a");
        pageLink.textContent = i;
        pageLink.href = "#";
        if (i === currentPage) pageLink.classList.add("active");

        pageLink.onclick = function() {
          searchJournals(lastQuery, i);
          return false;
        };

        paginationContainer.appendChild(pageLink);
      }

      // Tombol Next
      if (currentPage < totalPages) {
        let nextLink = document.createElement("a");
        nextLink.href = "#";
        nextLink.innerHTML = "&raquo;";
        nextLink.onclick = function() {
          searchJournals(lastQuery, currentPage + 1);
          return false;
        };
        paginationContainer.appendChild(nextLink);
      }

      document.getElementById("searchResults").appendChild(paginationContainer);
    }

    function toggleDarkMode() {
      document.body.classList.toggle("dark-mode");
      const isDarkMode = document.body.classList.contains("dark-mode");
      localStorage.setItem("darkMode", isDarkMode);
      document.getElementById("darkModeBtn").innerHTML = isDarkMode ? "‚òÄÔ∏è Mode Terang" : "üåô Mode Gelap";
      
      // Update logo berdasarkan mode
      const logo = document.getElementById("logo");
      if (logo) {
        logo.innerHTML = isDarkMode ? "üîç Wahasa Search" : "üìö Wahasa Search";
      }
    }

    // Handle Enter key press
    function handleKeyPress(event) {
      if (event.key === "Enter") {
        performSearch();
      }
    }

    // Handle perubahan filter tahun
    function handleYearFilter() {
      selectedYear = document.getElementById("yearFilter").value;
      if (lastQuery) {
        currentPage = 1;
        searchJournals(lastQuery, currentPage);
      }
    }

    // Generate opsi tahun untuk filter (dari 2000 hingga tahun sekarang)
    function generateYearOptions() {
      const yearSelect = document.getElementById("yearFilter");
      const currentYear = new Date().getFullYear();
      
      // Tambahkan opsi default
      const defaultOption = document.createElement("option");
      defaultOption.value = "";
      defaultOption.textContent = "Semua Tahun";
      yearSelect.appendChild(defaultOption);
      
      // Tambahkan opsi tahun dari 2000 hingga sekarang
      for (let year = currentYear; year >= 2000; year--) {
        const option = document.createElement("option");
        option.value = year;
        option.textContent = year;
        yearSelect.appendChild(option);
      }
    }

    // Fungsi untuk Citation Tools
    function toggleCitationTools() {
      showCitationTools = !showCitationTools;
      if (showCitationTools) {
        document.getElementById("citationTools").style.display = "block";
        document.getElementById("searchResults").style.display = "none";
        document.getElementById("newsContainer").style.display = "none";
      } else {
        document.getElementById("citationTools").style.display = "none";
        document.getElementById("searchResults").style.display = "block";
        document.getElementById("newsContainer").style.display = "block";
      }
    }

    function generateCitation() {
      const author = document.getElementById("citationAuthor").value || "Penulis Tidak Diketahui";
      const year = document.getElementById("citationYear").value || new Date().getFullYear();
      const title = document.getElementById("citationTitle").value || "Judul Tidak Diketahui";
      const journal = document.getElementById("citationJournal").value || "Jurnal Tidak Diketahui";
      
      const apaCitation = `${author}. (${year}). ${title}. <i>${journal}</i>.`;
      
      document.getElementById("citationResult").innerHTML = apaCitation;
    }

    function copyCitation() {
      const citationText = document.getElementById("citationResult").textContent;
      navigator.clipboard.writeText(citationText);
      alert("Kutipan telah disalin ke clipboard!");
    }

    window.onload = function() {
      fetchLatestNews();
      generateYearOptions();
      
      // Set dark mode from localStorage
      if (localStorage.getItem("darkMode") === "true") {
        document.body.classList.add("dark-mode");
        document.getElementById("darkModeBtn").innerHTML = "‚òÄÔ∏è Mode Terang";
      }
      
      // Focus on search input
      document.getElementById("searchInput").focus();
    };
  </script>
  <style>
    :root {
      --primary-color: #4361ee;
      --secondary-color: #3f37c9;
      --accent-color: #4895ef;
      --light-color: #f8f9fa;
      --dark-color: #212529;
      --text-color: #333;
      --text-light: #6c757d;
      --bg-color: #ffffff;
      --card-bg: #f8f9fa;
      --shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
      --border-radius: 8px;
    }

    .dark-mode {
      --primary-color: #4895ef;
      --secondary-color: #4361ee;
      --accent-color: #3f37c9;
      --light-color: #343a40;
      --dark-color: #f8f9fa;
      --text-color: #f1f1f1;
      --text-light: #adb5bd;
      --bg-color: #121212;
      --card-bg: #1e1e1e;
      --shadow: 0 4px 6px rgba(0, 0, 0, 0.3);
    }

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      font-family: 'Poppins', sans-serif;
      background-color: var(--bg-color);
      color: var(--text-color);
      line-height: 1.6;
      transition: all 0.3s ease;
      padding: 20px;
      min-height: 100vh;
    }

    .container {
      width: 100%;
      max-width: 1200px;
      margin: 0 auto;
      padding: 20px;
      background-color: var(--bg-color);
    }

    header {
      text-align: center;
      margin-bottom: 30px;
    }

    #logo {
      font-size: 2.5rem;
      margin-bottom: 10px;
      color: var(--primary-color);
    }

    .tagline {
      color: var(--text-light);
      margin-bottom: 20px;
    }

    .search-container {
      max-width: 800px;
      margin: 0 auto 30px;
    }

    .search-box {
      display: flex;
      box-shadow: var(--shadow);
      border-radius: var(--border-radius);
      overflow: hidden;
      margin-bottom: 15px;
    }

    #searchInput {
      flex: 1;
      padding: 15px 20px;
      border: none;
      font-size: 16px;
      background-color: var(--light-color);
      color: var(--text-color);
    }

    #searchInput:focus {
      outline: 2px solid var(--accent-color);
    }

    .search-box button {
      padding: 0 25px;
      background-color: var(--primary-color);
      color: white;
      border: none;
      cursor: pointer;
      font-size: 16px;
      transition: background 0.3s;
    }

    .search-box button:hover {
      background-color: var(--secondary-color);
    }

    .filter-container {
      display: flex;
      justify-content: space-between;
      align-items: center;
      flex-wrap: wrap;
      gap: 15px;
    }

    .year-filter {
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .year-filter label {
      color: var(--text-light);
      font-size: 14px;
    }

    #yearFilter {
      padding: 8px 12px;
      border-radius: var(--border-radius);
      border: 1px solid var(--text-light);
      background-color: var(--bg-color);
      color: var(--text-color);
      cursor: pointer;
    }

    .shortcuts {
      display: flex;
      justify-content: center;
      gap: 15px;
      margin-bottom: 30px;
      flex-wrap: wrap;
    }

    .shortcut {
      padding: 12px 20px;
      background-color: var(--primary-color);
      color: white;
      text-decoration: none;
      border-radius: var(--border-radius);
      font-size: 16px;
      transition: all 0.3s;
      display: flex;
      align-items: center;
      gap: 8px;
      cursor: pointer;
    }

    .shortcut:hover {
      background-color: var(--secondary-color);
      transform: translateY(-2px);
    }

    #darkModeBtn {
      position: fixed;
      bottom: 20px;
      right: 20px;
      padding: 10px 15px;
      background-color: var(--primary-color);
      color: white;
      border: none;
      border-radius: 50px;
      cursor: pointer;
      font-size: 14px;
      box-shadow: var(--shadow);
      z-index: 100;
      transition: all 0.3s;
    }

    #darkModeBtn:hover {
      background-color: var(--secondary-color);
    }

    /* Search Results */
    #searchResults {
      margin: 30px 0;
    }

    .results-header {
      margin-bottom: 20px;
      text-align: left;
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      flex-wrap: wrap;
      gap: 10px;
    }

    .results-header h3 {
      color: var(--primary-color);
      margin-right: 10px;
    }

    .year-filter-info {
      color: var(--text-light);
      font-size: 14px;
      font-style: italic;
    }

    .results-count {
      color: var(--text-light);
      font-size: 14px;
    }

    .results-grid {
      display: grid;
      grid-template-columns: 1fr;
      gap: 20px;
    }

    .result-card {
      background-color: var(--card-bg);
      border-radius: var(--border-radius);
      padding: 20px;
      box-shadow: var(--shadow);
      transition: transform 0.3s;
    }

    .result-card:hover {
      transform: translateY(-5px);
    }

    .result-card h3 {
      margin-bottom: 8px;
    }

    .result-card h3 a {
      color: var(--primary-color);
      text-decoration: none;
    }

    .result-card h3 a:hover {
      text-decoration: underline;
    }

    .result-url {
      color: var(--text-light);
      font-size: 14px;
      margin-bottom: 10px;
    }

    .result-snippet {
      color: var(--text-color);
      margin-bottom: 10px;
    }

    .result-meta {
      display: flex;
      gap: 10px;
      margin-top: 10px;
    }

    .result-year {
      background-color: var(--primary-color);
      color: white;
      padding: 3px 8px;
      border-radius: 12px;
      font-size: 12px;
    }

    /* News Container */
    #newsContainer {
      margin-top: 40px;
      background-color: var(--card-bg);
      border-radius: var(--border-radius);
      padding: 20px;
      box-shadow: var(--shadow);
    }

    .section-header {
      margin-bottom: 20px;
    }

    .section-header h3 {
      color: var(--primary-color);
    }

    .news-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
      gap: 20px;
    }

    .news-card {
      background-color: var(--bg-color);
      border-radius: var(--border-radius);
      overflow: hidden;
      box-shadow: var(--shadow);
      display: flex;
      flex-direction: column;
      transition: transform 0.3s;
    }

    .news-card:hover {
      transform: translateY(-5px);
    }

    .news-content {
      padding: 15px;
      flex: 1;
    }

    .news-card h4 {
      margin-bottom: 10px;
    }

    .news-card h4 a {
      color: var(--text-color);
      text-decoration: none;
    }

    .news-card h4 a:hover {
      color: var(--primary-color);
      text-decoration: underline;
    }

    .news-snippet {
      color: var(--text-light);
      font-size: 14px;
      margin-bottom: 10px;
    }

    .news-date {
      color: var(--text-light);
      font-size: 12px;
      font-style: italic;
    }

    .news-image {
      width: 100%;
      height: 180px;
      object-fit: cover;
    }

    /* Pagination */
    .pagination {
      display: flex;
      justify-content: center;
      margin-top: 30px;
      gap: 5px;
    }

    .pagination a {
      padding: 8px 15px;
      text-decoration: none;
      color: var(--primary-color);
      border: 1px solid var(--primary-color);
      border-radius: var(--border-radius);
      transition: all 0.3s;
    }

    .pagination a:hover {
      background-color: var(--primary-color);
      color: white;
    }

    .pagination a.active {
      background-color: var(--primary-color);
      color: white;
      font-weight: bold;
    }

    /* Loading Spinner */
    .loading-spinner {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      padding: 40px;
    }

    .spinner {
      width: 40px;
      height: 40px;
      border: 4px solid rgba(0, 0, 0, 0.1);
      border-left-color: var(--primary-color);
      border-radius: 50%;
      animation: spin 1s linear infinite;
      margin-bottom: 15px;
    }

    @keyframes spin {
      to { transform: rotate(360deg); }
    }

    /* No Data/Error Messages */
    .no-data, .error-msg {
      text-align: center;
      padding: 40px;
      color: var(--text-light);
    }

    .no-results {
      text-align: center;
      padding: 40px;
    }

    .no-results img {
      margin-bottom: 20px;
    }

    /* Citation Tools Styles */
    #citationTools {
      display: none;
      margin-top: 30px;
      background-color: var(--card-bg);
      border-radius: var(--border-radius);
      padding: 20px;
      box-shadow: var(--shadow);
    }

    .citation-form {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 15px;
      margin-bottom: 20px;
    }

    .citation-form-group {
      margin-bottom: 15px;
    }

    .citation-form label {
      display: block;
      margin-bottom: 5px;
      font-weight: 500;
    }

    .citation-form input {
      width: 100%;
      padding: 10px;
      border: 1px solid var(--border-color);
      border-radius: var(--border-radius);
      background-color: var(--bg-color);
      color: var(--text-color);
    }

    .citation-result {
      margin-top: 20px;
      padding: 15px;
      background-color: var(--light-color);
      border-radius: var(--border-radius);
      font-family: 'Times New Roman', serif;
    }

    .dark-mode .citation-result {
      background-color: var(--card-bg);
    }

    .citation-actions {
      margin-top: 15px;
      display: flex;
      gap: 10px;
    }

    /* Responsive */
    @media (max-width: 768px) {
      .container {
        padding: 15px;
      }
      
      .search-box {
        flex-direction: column;
      }
      
      #searchInput {
        width: 100%;
        margin-bottom: 10px;
      }
      
      .search-box button {
        width: 100%;
        padding: 12px;
      }
      
      .news-grid {
        grid-template-columns: 1fr;
      }
      
      .shortcuts {
        flex-direction: column;
        align-items: center;
      }
      
      .shortcut {
        width: 100%;
        text-align: center;
      }
      
      .filter-container {
        flex-direction: column;
        align-items: flex-start;
      }

      .citation-form {
        grid-template-columns: 1fr;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <h1 id="logo">üìö Wahasa Search</h1>
      <p class="tagline">Platform Pencarian Jurnal Ilmiah dan Berita Terkini</p>
    </header>

    <div class="search-container">
      <div class="search-box">
        <input type="text" id="searchInput" placeholder="Cari jurnal ilmiah..." onkeypress="handleKeyPress(event)">
        <button onclick="performSearch()">Cari</button>
      </div>
      
      <div class="filter-container">
        <div class="year-filter">
          <label for="yearFilter">Filter Tahun:</label>
          <select id="yearFilter" onchange="handleYearFilter()">
            <!-- Opsi tahun akan di-generate oleh JavaScript -->
          </select>
        </div>
      </div>
    </div>

    <div class="shortcuts">
      <button class="shortcut" onclick="toggleCitationTools()">üìù Citation Tools</button>
      <a href="https://sma-waha1.sch.id/" target="_blank" class="shortcut">üè´ Website Sekolah</a>
      <a href="https://digilibsmawh1.perpustakaan.co.id/home.ks" target="_blank" class="shortcut">üìñ Perpustakaan Digital</a>
    </div>

    <div id="searchResults"></div>
    <div id="newsContainer"></div>

    <!-- Citation Tools Section -->
    <div id="citationTools">
      <h2>Citation Generator</h2>
      <p>Generate kutipan dalam format APA (7th Edition)</p>
      
      <div class="citation-form">
        <div class="citation-form-group">
          <label for="citationAuthor">Nama Penulis:</label>
          <input type="text" id="citationAuthor" placeholder="Contoh: Smith, J.">
        </div>
        <div class="citation-form-group">
          <label for="citationYear">Tahun Publikasi:</label>
          <input type="number" id="citationYear" placeholder="Contoh: 2023">
        </div>
        <div class="citation-form-group">
          <label for="citationTitle">Judul Artikel:</label>
          <input type="text" id="citationTitle" placeholder="Judul artikel">
        </div>
        <div class="citation-form-group">
          <label for="citationJournal">Nama Jurnal:</label>
          <input type="text" id="citationJournal" placeholder="Nama jurnal">
        </div>
      </div>
      
      <button onclick="generateCitation()">Generate Citation</button>
      
      <div class="citation-result" id="citationResult">
        Hasil kutipan akan muncul di sini...
      </div>
      
      <div class="citation-actions">
        <button onclick="copyCitation()">Salin Kutipan</button>
        <button onclick="toggleCitationTools()">Kembali ke Pencarian</button>
      </div>
    </div>
  </div>

  <button id="darkModeBtn" onclick="toggleDarkMode()">üåô Mode Gelap</button>
</body>
</html>
